!function(){"use strict";var e=Object.freeze({OK:200,NOT_FOUND:404,FORBIDDEN:403,INTERNAL_ERROR:500});function r(e,r){for(var t=0;t<r.length;t++){var s=r[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var t=new(function(){function t(e){!function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),this._jwtToken=e||null,this._headers=this._createRequestHeaders()}var s,n;return s=t,(n=[{key:"_createRequestHeaders",value:function(){return[["Content-Type","application/json; charset=UTF-8"],["Accept","application/json"],["X-XSRF-TOKEN",this._jwtToken]]}},{key:"_getErrorCodeFromHTTPStatus",value:function(r){return r===e.NOT_FOUND?"B_KOM_NOT_FOUND":r===e.FORBIDDEN?"B_KOM_ACCESS_FORBIDDEN":r===e.INTERNAL_ERROR?"B_KOM_INTERNAL_ERROR":"B_KOM_UNKNOWN_ERROR"}},{key:"_resolveAs",value:function(r,t){var s=this;return new Promise((function(n,a){t?"raw"===r?t.status===e.OK?n(t.responseText):a(s._getErrorCodeFromHTTPStatus(t.status)):"json"===r||"text"===r?t[r]?n(t[r]()):a(s._getErrorCodeFromHTTPStatus(t.status)):a("F_KOM_UNSUPPORTED_TYPE"):a("F_KOM_MISSING_ARGUMENT")}))}},{key:"_resolveAsJSON",value:function(e){return this._resolveAs("json",e)}},{key:"_resolveAsText",value:function(e){return this._resolveAs("text",e)}},{key:"_resolveAsRaw",value:function(e){return this._resolveAs("raw",e)}},{key:"_xhrCall",value:function(e,r,t){var s=this;return new Promise((function(n,a){var o=new XMLHttpRequest;o.open(r,e,!0),o.overrideMimeType("text/plain; charset=x-user-defined"),o.onreadystatechange=function(e){4===e.target.readyState&&s._resolveAsRaw(e.target).then(n).catch(a)},o.onerror=function(){a("F_KOM_XHR_ERROR")},o.send(t)}))}},{key:"get",value:function(e){var r=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._resolveAsJSON.bind(this);return new Promise((function(s,n){var a={method:"GET",headers:new Headers([r._headers[0]])};fetch(e,a).then(t).then(s).catch(n)}))}},{key:"getText",value:function(e){return this.get(e,this._resolveAsText.bind(this))}},{key:"getRaw",value:function(e){var r=this;return new Promise((function(t,s){r._xhrCall(e,"GET",null).then(t).catch(s)}))}},{key:"post",value:function(e,r){var t=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._resolveAsJSON.bind(this);return new Promise((function(n,a){var o={method:"POST",headers:new Headers(t._headers),body:JSON.stringify(r)};fetch(e,o).then(s).then(n).catch(a)}))}},{key:"postText",value:function(e,r){return this.post(e,r,this._resolveAsText.bind(this))}},{key:"postRaw",value:function(e,r){var t=this;return new Promise((function(s,n){t._xhrCall(e,"POST",JSON.stringify(r)).then(s).catch(n)}))}},{key:"postForm",value:function(e,r){var t=this;return new Promise((function(s,n){var a=document.createElement("FORM");for(var o in a.method="POST",a.action=e,r)if(Object.prototype.hasOwnProperty.call(r,o)){var i=document.createElement("INPUT");i.type="hidden",i.name=o,i.value=r[o],a.appendChild(i)}var c=new XMLHttpRequest;c.open("POST",e),c.setRequestHeader("X-XSRF-TOKEN",t._csrfToken),c.onreadystatechange=function(e){if(4===e.target.readyState)try{var r=JSON.parse(e.target.response);s(r)}catch(r){n(e.target.response)}},c.onerror=function(){n("F_KOM_XHR_ERROR")};var u=new FormData(a);c.send(u)}))}},{key:"jwtToken",get:function(){return this._jwtToken},set:function(e){this._jwtToken=e}}])&&r(s.prototype,n),t}()),s=/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/,n=function(e){for(var r=Object.keys(e),t=0;t<r.length;++t)e[r[t]].classList.remove("error")},a=document.querySelector("#register-submit");if(a){var o={username:document.querySelector("#username"),email:document.querySelector("#email"),code:document.querySelector("#code"),pass1:document.querySelector("#pass1"),pass2:document.querySelector("#pass2"),error:document.querySelector("#error-output"),loading:document.querySelector("#line-loader")},i=function(e){o.loading.style.opacity="0",200===e.status?window.location.href=e.url:(o.error.classList.add("error"),o.error.innerHTML=e.message,"B_REGISTER_EXISTING_USERNAME"===e.code?o.username.classList.add("error"):"B_REGISTER_EXISTING_EMAIL"===e.code?o.email.classList.add("error"):"B_REGISTER_MISSING_FIELD"===e.code?(e.missing.username&&o.username.classList.add("error"),e.missing.email&&o.email.classList.add("error"),e.missing.code&&o.code.classList.add("error"),e.missing.pass1&&o.pass1.classList.add("error"),e.missing.pass2&&o.pass2.classList.add("error")):"B_REGISTER_DIFFERENT_PASSWORDS"===e.code||"B_REGISTER_PASSWORD_TOO_SHORT"===e.code?(o.pass1.classList.add("error"),o.pass2.classList.add("error")):"B_REGISTER_INVALID_CODE"===e.code&&o.code.classList.add("error"))};a.addEventListener("click",(function(e){e.preventDefault();var r,a=new FormData(document.querySelector("#register-form")),c=Object.fromEntries(a.entries());o.error.innerHTML="",n(o),((r=c).username&&r.username.length<1?(o.error.innerHTML="Username must at least contain one character.",o.username.classList.add("error"),0):r.email&&!s.test(r.email)?(o.error.innerHTML="Provided email is invalid",o.email.classList.add("error"),0):r.pass1===r.pass2||(o.error.innerHTML="The two provided passwords are not matching.",o.pass1.classList.add("error"),o.pass2.classList.add("error"),0))&&(o.loading.style.opacity="1",t.post("/api/auth/register",c).then(i).catch(i))}))}var c=document.querySelector("#login-submit");if(c){var u={username:document.querySelector("#username"),password:document.querySelector("#password"),error:document.querySelector("#error-output"),loading:document.querySelector("#line-loader")},d=function(e){u.loading.style.opacity="0",200===e.status?window.location.href=e.url:(u.error.classList.add("error"),u.error.innerHTML=e.message,"B_LOGIN_MISSING_FIELD"===e.code?(e.missing.username&&u.username.classList.add("error"),e.missing.password&&u.password.classList.add("error")):"B_LOGIN_USER_NOT_FOUND"===e.code?u.username.classList.add("error"):"B_LOGIN_INVALID_PASSWORD"===e.code&&u.password.classList.add("error"))};c.addEventListener("click",(function(e){e.preventDefault();var r=new FormData(document.querySelector("#login-form")),s=Object.fromEntries(r.entries());u.loading.style.opacity="1",u.error.innerHTML="",n(u),t.post("/api/auth/login",s).then(d).catch(d)}))}window.UserStack={}.default}();