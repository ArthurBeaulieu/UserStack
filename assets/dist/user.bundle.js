!function(){"use strict";var e=Object.freeze({OK:200,NOT_FOUND:404,FORBIDDEN:403,INTERNAL_ERROR:500});function t(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var r=new(function(){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this._jwtToken=e||null,this._headers=this._createRequestHeaders()}var s,n;return s=r,(n=[{key:"_createRequestHeaders",value:function(){return[["Content-Type","application/json; charset=UTF-8"],["Accept","application/json"],["X-XSRF-TOKEN",this._jwtToken]]}},{key:"_getErrorCodeFromHTTPStatus",value:function(t){return t===e.NOT_FOUND?"B_KOM_NOT_FOUND":t===e.FORBIDDEN?"B_KOM_ACCESS_FORBIDDEN":t===e.INTERNAL_ERROR?"B_KOM_INTERNAL_ERROR":"B_KOM_UNKNOWN_ERROR"}},{key:"_resolveAs",value:function(t,r){var s=this;return new Promise((function(n,a){r?"raw"===t?r.status===e.OK?n(r.responseText):a(s._getErrorCodeFromHTTPStatus(r.status)):"json"===t||"text"===t?r[t]?n(r[t]()):a(s._getErrorCodeFromHTTPStatus(r.status)):a("F_KOM_UNSUPPORTED_TYPE"):a("F_KOM_MISSING_ARGUMENT")}))}},{key:"_resolveAsJSON",value:function(e){return this._resolveAs("json",e)}},{key:"_resolveAsText",value:function(e){return this._resolveAs("text",e)}},{key:"_resolveAsRaw",value:function(e){return this._resolveAs("raw",e)}},{key:"_xhrCall",value:function(e,t,r){var s=this;return new Promise((function(n,a){var o=new XMLHttpRequest;o.open(t,e,!0),o.overrideMimeType("text/plain; charset=x-user-defined"),o.onreadystatechange=function(e){4===e.target.readyState&&s._resolveAsRaw(e.target).then(n).catch(a)},o.onerror=function(){a("F_KOM_XHR_ERROR")},o.send(r)}))}},{key:"get",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._resolveAsJSON.bind(this);return new Promise((function(s,n){var a={method:"GET",headers:new Headers([t._headers[0]])};fetch(e,a).then(r).then(s).catch(n)}))}},{key:"getText",value:function(e){return this.get(e,this._resolveAsText.bind(this))}},{key:"getRaw",value:function(e){var t=this;return new Promise((function(r,s){t._xhrCall(e,"GET",null).then(r).catch(s)}))}},{key:"post",value:function(e,t){var r=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._resolveAsJSON.bind(this);return new Promise((function(n,a){var o={method:"POST",headers:new Headers(r._headers),body:JSON.stringify(t)};fetch(e,o).then(s).then(n).catch(a)}))}},{key:"postText",value:function(e,t){return this.post(e,t,this._resolveAsText.bind(this))}},{key:"postRaw",value:function(e,t){var r=this;return new Promise((function(s,n){r._xhrCall(e,"POST",JSON.stringify(t)).then(s).catch(n)}))}},{key:"postForm",value:function(e,t){var r=this;return new Promise((function(s,n){var a=document.createElement("FORM");for(var o in a.method="POST",a.action=e,t)if(Object.prototype.hasOwnProperty.call(t,o)){var i=document.createElement("INPUT");i.type="hidden",i.name=o,i.value=t[o],a.appendChild(i)}var u=new XMLHttpRequest;u.open("POST",e),u.setRequestHeader("X-XSRF-TOKEN",r._csrfToken),u.onreadystatechange=function(e){if(4===e.target.readyState)try{var t=JSON.parse(e.target.response);s(t)}catch(t){n(e.target.response)}},u.onerror=function(){n("F_KOM_XHR_ERROR")};var c=new FormData(a);u.send(c)}))}},{key:"jwtToken",get:function(){return this._jwtToken},set:function(e){this._jwtToken=e}}])&&t(s.prototype,n),r}()),s=function(e){for(var t=Object.keys(e),r=0;r<t.length;++r)e[t[r]].classList.remove("error")},n=document.querySelector("#edit-profile-info-submit");if(n){var a={username:document.querySelector("#username"),email:document.querySelector("#email"),error:document.querySelector("#error-output"),loading:document.querySelector("#line-loader")},o=function(e){a.loading.style.opacity="0",200===e.status?(a.username.value=e.info.username,a.email.value=e.info.email,e.taken.username&&a.username.classList.add("error"),e.taken.email&&a.email.classList.add("error"),e.message&&(a.error.innerHTML=e.message)):"B_USER_INFO_NO_CHANGES"===e.code&&(a.error.innerHTML=e.message)};n.addEventListener("click",(function(e){e.preventDefault();var t=new FormData(document.querySelector("#edit-profile-info-form")),n=Object.fromEntries(t.entries());a.loading.style.opacity="1",a.error.innerHTML="",s(a),r.post("/api/user/update/info",n).then(o).catch(o)}))}var i=document.querySelector("#edit-profile-password-submit");if(i){var u={pass1:document.querySelector("#pass1"),pass2:document.querySelector("#pass2"),pass3:document.querySelector("#pass3"),error:document.querySelector("#error-output"),loading:document.querySelector("#line-loader")},c=function(e){u.loading.style.opacity="0",u.error.innerHTML=e.message,200===e.status?(u.pass1.value="",u.pass2.value="",u.pass3.value=""):(u.error.classList.add("error"),"B_USER_PASSWORD_NO_CHANGES"===e.code?(u.pass1.classList.add("error"),u.pass2.classList.add("error"),u.pass3.classList.add("error")):"B_USER_PASSWORD_MISSING_FIELD"===e.code?(e.missing.pass1&&u.pass1.classList.add("error"),e.missing.pass2&&u.pass2.classList.add("error"),e.missing.pass3&&u.pass3.classList.add("error")):"B_USER_PASSWORD_NOT_VALID"===e.code?u.pass1.classList.add("error"):("B_USER_PASSWORD_DIFFERENT_PASSWORDS"===e.code||"B_USER_PASSWORD_TOO_SHORT"===e.code)&&(u.pass2.classList.add("error"),u.pass3.classList.add("error")))};i.addEventListener("click",(function(e){e.preventDefault();var t=new FormData(document.querySelector("#edit-profile-password-form")),n=Object.fromEntries(t.entries());u.loading.style.opacity="1",u.error.innerHTML="",s(u),r.post("/api/user/update/password",n).then(c).catch(c)}))}var l=document.querySelector("#delete-account");if(l){var d=document.querySelector("#error-output"),_=function(e){200===e.status?window.location.href=e.url:"B_NEVER_KILL_JESUS"===e.code&&(d.innerHTML=e.message)};l.addEventListener("click",(function(){r.get("/api/user/delete").then(_).catch(_)}))}window.UserStack={}.default}();